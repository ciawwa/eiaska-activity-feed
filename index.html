<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Activity Feed</title>

<!-- Silkscreen font -->
<link href="https://fonts.googleapis.com/css2?family=Silkscreen:wght@400;700&display=swap" rel="stylesheet">

<style>
body {
  margin: 0;
  font-family: 'Silkscreen', monospace;
  font-weight: normal;
  background: #CCCCCC; /* Background hex from buyer */
  color: #747474; /* Text hex from buyer */
}
.feed {
  display: flex;
  flex-direction: column;
  gap: 14px;
  padding: 10px;
}
.card {
  display: block;
  background: #CCCCCC; /* Card same as background */
  border-radius: 18px;
  padding: 14px 16px;
  text-decoration: none;
  color: inherit;
  border: 1px solid #747474; /* Line color from buyer */
}
.top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 13px;
  font-weight: normal; /* regular */
  padding-bottom: 8px;
  border-bottom: 1px solid #747474; /* Line color */
  margin-bottom: 8px;
}
.time {
  font-size: 12px;
  font-weight: normal;
}
.time.live {
  padding: 4px 8px;
  border-radius: 999px;
  border: 1px solid #747474;
  background: rgba(255,255,255,0.2);
}
.text {
  font-size: 13px;
  line-height: 1.45;
  color: #fff; /* optional: main text white for contrast */
}
</style>
</head>
<body>

<div class="feed" id="feedContainer"></div>

<script>
// --- SETTINGS ---
const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSJdZ2ZZIRkU-Ukws8BGBs-E543ILEsysG-fzrTZlnTtvt6eoo9Mn4wfcBUaCVzsCIpkM9AjJaF8Lzw/pub?output=csv"; // Google Sheet CSV
const TWITCH_USERNAME = "elaska"; // Twitch username

// --- FUNCTIONS ---

// Fetch Google Sheet data
async function fetchSheetData() {
  const res = await fetch(SHEET_CSV_URL);
  const text = await res.text();
  const rows = text.trim().split('\n');
  const headers = rows[0].split(',');
  // map rows into objects and **ignore Twitch rows**
  const items = rows.slice(1).map(r=>{
    const cols = r.split(',');
    return {
      platform: cols[0],
      text: cols[1],
      label: cols[2],
      url: cols[3]
    };
  }).filter(item => item.platform.toLowerCase() !== "twitch"); // <- ignore Twitch
  return items;
}

// Fetch Twitch LIVE status
async function checkTwitchStatus() {
  try {
    const res = await fetch(`https://decapi.me/twitch/uptime/${TWITCH_USERNAME}`, { cache: "no-store" });
    const status = (await res.text()).trim().toLowerCase();
    if (status.includes("offline")) {
      return { label: "Offline", text: "Elaska is currently offline on Twitch" };
    } else {
      return { label: "LIVE", text: "Elaska is live on Twitch streaming!" };
    }
  } catch (e) {
    return { label: "", text: "Unable to fetch Twitch status" };
  }
}

// Render the feed
async function renderFeed() {
  const container = document.getElementById("feedContainer");
  container.innerHTML = "";

  const sheetItems = await fetchSheetData();
  const twitchStatus = await checkTwitchStatus();

  // Twitch card always on top
  const twitchItem = {
    platform: "Twitch",
    text: twitchStatus.text,
    label: twitchStatus.label,
    url: `https://www.twitch.tv/${TWITCH_USERNAME}`
  };

  const allItems = [twitchItem, ...sheetItems];

  // Sort newest activity first: label="NOW" moves to top
  allItems.sort((a, b) => {
    if (a.label === "NOW") return -1;
    if (b.label === "NOW") return 1;
    return 0;
  });

  allItems.forEach(item => {
    const card = document.createElement("a");
    card.href = item.url;
    card.target = "_blank";
    card.className = "card";
    card.innerHTML = `
      <div class="top">
        <div>${item.platform}</div>
        <div class="time ${item.label === "LIVE" ? "live" : ""}">${item.label || ""}</div>
      </div>
      <div class="text">${item.text}</div>
    `;
    container.appendChild(card);
  });
}

// Initial render + refresh every 60s
renderFeed();
setInterval(renderFeed, 60000);

</script>
</body>
</html>
